"use strict";var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.DragFields=WPForms.Admin.Builder.DragFields||function(g){let c={},w={},b;const F={init:function(){g(F.ready)},ready:function(){F.setup(),F.initSortableFields(),F.events()},setup:function(){c={$builder:g("#wpforms-builder"),$sortableFieldsWrap:g("#wpforms-panel-fields .wpforms-field-wrap"),$addFieldsButtons:g(".wpforms-add-fields-button").not(".not-draggable").not(".warning-modal").not(".education-modal")}},events:function(){c.$builder.on("wpformsFieldDragToggle",F.fieldDragToggleEvent)},disableDragAndDrop:function(){c.$addFieldsButtons.filter(".ui-draggable").draggable("disable"),c.$sortableFieldsWrap.sortable("disable"),c.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("disable")},enableDragAndDrop:function(){c.$addFieldsButtons.filter(".ui-draggable").draggable("enable"),c.$sortableFieldsWrap.sortable("enable"),c.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("enable")},fieldDragDisable:function(e,r=!0){if(e.hasClass("ui-draggable-disabled"))e.draggable("enable");else{let l;e.draggable({revert:!0,axis:"y",delay:100,opacity:1,cursor:"move",start:function(e,i){l=i.position.top},drag:function(e,i){if(15<Math.abs(i.position.top)-Math.abs(l))return r&&F.youCantReorderFieldPopup(),!1}})}},fieldDragEnable:function(e){e.hasClass("ui-draggable")||e.draggable("disable")},youCantReorderFieldPopup:function(){g.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.field_cannot_be_reordered,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},fieldDragToggleEvent:function(e,i){i=g("#wpforms-field-"+i);i.hasClass("wpforms-field-not-draggable")||i.hasClass("wpforms-field-stick")?F.fieldDragDisable(i):F.fieldDragEnable(i)},initSortableFields:function(){F.initSortableContainer(c.$sortableFieldsWrap),c.$builder.find(".wpforms-layout-column").each(function(){F.initSortableContainer(g(this))}),F.fieldDragDisable(g(".wpforms-field-not-draggable, .wpforms-field-stick")),F.initDraggableFields()},initSortableContainer:function(d){const o=g("#wpforms-field-options");let a,s,n,t,f,m,p=g("#wpforms-panel-fields .wpforms-panel-content-wrap"),u=!1;d.sortable({items:"> .wpforms-field:not(.wpforms-field-stick):not(.no-fields-preview)",connectWith:".wpforms-field-wrap, .wpforms-layout-column",delay:100,opacity:1,cursor:"move",cancel:".wpforms-field-not-draggable",placeholder:"wpforms-field-drag-placeholder",appendTo:"#wpforms-panel-fields",zindex:1e4,tolerance:"pointer",distance:1,start(e,i){a=i.item.data("field-id"),s=i.item.data("field-type"),n=void 0===a,t=g("#wpforms-field-option-"+a),w.fieldReceived=!1,w.fieldRejected=!1,w.$sortableStart=d,w.startPosition=i.item.first().index(),c.$builder.trigger("wpformsFieldDragStart",[a])},beforeStop(){!w.glitchChange||b.isFieldAllowedInColum(s)||(w.fieldRejected=!0)},stop(e,i){var l,r=i.item.first();i.placeholder.removeClass("wpforms-field-drag-not-allowed"),r.removeClass("wpforms-field-drag-not-allowed"),w.fieldRejected?(F.revertMoveFieldToColumn(r),c.$builder.trigger("wpformsFieldMoveRejected",[r,i])):(m=r.prev(".wpforms-field, .wpforms-alert").data("field-id"),0<(f=g("#wpforms-field-option-"+m)).length?f.after(t):o.prepend(t),!n&&r.closest(".wpforms-layout-column").is(d)&&b.positionFieldInColumn(a,r.index()-1,d),l=r.closest(".wpforms-field-layout"),b.fieldOptionsUpdate(null,a),b.reorderLayoutFieldsOptions(l),n||r.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over"),r.attr("style",""),c.$builder.trigger("wpformsFieldMove",i),w.fieldReceived=!1)},over(e,i){var l,i=i.item.first(),e=g(e.target),r=e.find(".wpforms-field-drag-placeholder"),o=e.hasClass("wpforms-layout-column"),d={width:e.outerWidth(),height:i.outerHeight()};let t=o?" wpforms-field-drag-to-column":"";o&&(l=e.attr("class").match(/wpforms-layout-column-(\d+)/)[1],t+=" wpforms-field-drag-to-column-"+l),a=i.data("field-id"),s=i.data("field-type")||w.fieldType,n=void 0===a,i.addClass("wpforms-field-dragging"+t).css({width:o?d.width-5:d.width,height:"auto"}),r.removeClass("wpforms-field-drag-not-allowed").css({height:n?d.height+18:d.height}),!b.isFieldAllowedInColum(s)&&o&&(r.addClass("wpforms-field-drag-not-allowed"),i.addClass("wpforms-field-drag-not-allowed")),c.$builder.trigger("wpformsFieldDragOver",[a,e]),n&&i.addClass("wpforms-field-drag-over").removeClass("wpforms-field-drag-out")},out(e,i){var l=i.item.first(),r=void 0===l.data("field-id");l.removeClass("wpforms-field-drag-not-allowed").removeClass(function(e,i){return(i.match(/wpforms-field-drag-to-column(-\d+|)/g)||[]).join(" ")}),w.fieldReceived?l.attr("style",""):r?l.addClass("wpforms-field-drag-out").removeClass("wpforms-field-drag-over"):g(i.sender).closest(".wpforms-field-layout").removeClass("wpforms-field-child-hovered")},receive(e,i){var l=g(i.helper||i.item),r=(a=l.data("field-id"),s=l.data("field-type")||w.fieldType,void 0===a),o=d.hasClass("wpforms-layout-column");!b.isFieldAllowedInColum(s)&&o?w.fieldRejected=!0:(w.fieldReceived=!0,l.removeClass("wpforms-field-drag-over"),r?(r=d.data("ui-sortable").currentItem.index(),l.addClass("wpforms-field-drag-over wpforms-field-drag-pending").removeClass("wpforms-field-drag-out").append(WPFormsBuilder.settings.spinnerInline).css("width","100%"),c.$builder.find(".no-fields-preview").remove(),WPFormsBuilder.fieldAdd(w.fieldType,{position:o?r-1:r,placeholder:l,$sortable:d}),w.fieldType=void 0):b.receiveFieldToColumn(a,i.item.index()-1,l.parent()))},change(e,i){i=i.placeholder.parent(),e=g(e.target);w.glitchChange=!1,!d.is(i)&&d.hasClass("wpforms-field-wrap")&&i.hasClass("wpforms-layout-column")&&(w.glitchChange=!0),c.$builder.trigger("wpformsFieldDragChange",[a,e])},sort(i){if(!u){var i=i.clientY,l=p.offset(),r=p.height(),o=l.top+r;let e;if(i>l.top&&i<l.top+50)e="-=";else{if(!(o-50<i&&i<o))return;e="+="}u=!0,p.animate({scrollTop:e+r/3+"px"},800,function(){u=!1})}}})},initDraggableFields:function(){c.$addFieldsButtons.draggable({connectToSortable:".wpforms-field-wrap, .wpforms-layout-column",delay:200,cancel:!1,scroll:!1,opacity:1,appendTo:"#wpforms-panel-fields",zindex:1e4,helper(){var e=g(this),i=g('<div class="wpforms-field-drag-out wpforms-field-drag">');return w.fieldType=e.data("field-type"),i.html(e.html())},start(e,i){if(WPFormsUtils.triggerEvent(c.$builder,"wpformsFieldAddDragStart",[w.fieldType,i]).isDefaultPrevented())return!1},stop(e,i){if(WPFormsUtils.triggerEvent(c.$builder,"wpformsFieldAddDragStop",[w.fieldType,i]).isDefaultPrevented())return!1}})},revertMoveFieldToColumn:function(e){var i;void 0===e.data("field-id")?e.remove():(e=e.detach(),i=w.$sortableStart.find("> .wpforms-field").eq(w.startPosition),e.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over").attr("style",""),i.length?i.before(e):w.$sortableStart.append(e))}};return b={positionFieldInColumn:function(e,i,l){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.positionFieldInColumn(e,i,l)},receiveFieldToColumn:function(e,i,l){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.receiveFieldToColumn(e,i,l)},fieldOptionsUpdate:function(e,i){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.fieldOptionsUpdate(e,i)},reorderLayoutFieldsOptions:function(e){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.reorderLayoutFieldsOptions(e)},isFieldAllowedInColum:function(e){return!WPForms.Admin.Builder.FieldLayout||WPForms.Admin.Builder.FieldLayout.isFieldAllowedInColum(e)}},F}((document,window,jQuery)),WPForms.Admin.Builder.DragFields.init();