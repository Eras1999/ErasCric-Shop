var WPFormsStripePaymentElement=window.WPFormsStripePaymentElement||function(e,i,l){let d;const s={stripe:null,forms:{},init(){s.stripe=Stripe(wpforms_stripe.publishable_key,{locale:wpforms_stripe.data.element_locale,betas:["elements_enable_deferred_intent_beta_1"]}),l(e).on("wpformsReady",function(){s.initializeFormsDefaultObject(),l(".wpforms-stripe form").each(s.setupStripeForm).on("wpformsConvFormsFieldActivationAfter",s.convFormsFieldActivationAfter)}),l(e).on("wpformsBeforePageChange",s.pageChange).on("wpformsAmountTotalCalculated",s.updateElementsTotalAmount).on("wpformsProcessConditionalsField",function(e,o,r,t,n){s.processConditionalsField(o,r,t,n)})},initializeFormsDefaultObject(){l(".wpforms-stripe form").each(function(){var e=l(this).data("formid");s.forms[e]={elements:null,paymentElement:null,elementsModified:!1,linkElement:null,linkEmail:"",linkDestroyed:!1,paymentType:"",lockedPageToSwitch:0,paymentMethodId:"",total:""}})},setupStripeForm(){var e,o=l(this),r=o.find(".wpforms-field-stripe-credit-card");r.find(".wpforms-field-row").length&&(e=o.data("validator"))&&(d=e.settings.submitHandler,e.settings.submitHandler=s.submitHandler,o.on("wpformsAjaxSubmitActionRequired",s.confirmPaymentActionCallback),r.hasClass("wpforms-conditional-field")||s.setupPaymentElement(o))},async confirmPaymentActionCallback(e,o){if(o.success&&o.data.action_required){const n=l(this);var r=new URL(i.location.href),t=n.data("formid");await s.stripe.confirmPayment({clientSecret:o.data.payment_intent_client_secret,confirmParams:{return_url:r.toString(),payment_method:s.forms[t].paymentMethodId},redirect:"if_required"}).then(function(e){s.handleConfirmPayment(n,e)})}},handleConfirmPayment(e,o){var r;o.error?s.displayStripeError(e,o.error.message):(r=e.data("formid"),o.paymentIntent&&"succeeded"===o.paymentIntent.status?(e.find(".wpforms-stripe-payment-method-id").remove(),e.find(".wpforms-stripe-payment-intent-id").remove(),e.append('<input type="hidden" class="wpforms-stripe-payment-intent-id" name="wpforms[payment_intent_id]" value="'+o.paymentIntent.id+'">'),e.append('<input type="hidden" class="wpforms-stripe-payment-link-email" name="wpforms[payment_link_email]" value="'+s.forms[r].linkEmail+'">'),wpforms.formSubmitAjax(e)):s.formAjaxUnblock(e))},setupPaymentElement(e){var o=e.data("formid");l.isEmptyObject(s.forms)&&s.initializeFormsDefaultObject(),s.forms[o].paymentElement||(s.forms[o].elements=s.stripe.elements({currency:wpforms.getCurrency().code.toLowerCase(),mode:"payment",amount:77777,loader:"always",locale:wpforms_stripe.data.element_locale,appearance:s.getElementAppearanceOptions(e)}),s.initializePaymentElement(e),s.linkEmailMappedFieldTriggers(e),wpforms.amountTotalCalc(e),s.updatePaymentElementStylesModern(e))},processConditionalsField(e,o,r,t){var n=l("#wpforms-form-"+e),i=n.find(".wpforms-field-stripe-credit-card"),r=r&&"hide"===t||!r&&"hide"!==t;!i.length||i.data("field-id").toString()!==o||s.forms[e].paymentElement||r||s.setupPaymentElement(n)},getElementAppearanceOptions(e){var o,r,t=s.getCustomAppearanceOptions();return l.isEmptyObject(t)?(r=e.find(".wpforms-stripe-credit-card-hidden-input"),o=!(e=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row")).hasClass("wpforms-sublabel-hide"),r={borderColor:s.getCssPropertyValue(r,"--field-border")||s.getCssPropertyValue(r,"border-color"),borderRadius:s.getCssPropertyValue(r,"border-radius"),fontSize:s.getCssPropertyValue(r,"font-size"),colorPrimary:s.getCssPropertyValue(r,"--primary-color")||s.getCssPropertyValue(r,"color"),colorText:s.getCssPropertyValue(r,"--secondary-color")||s.getCssPropertyValue(r,"color"),colorTextPlaceholder:s.getCssPropertyValue(r,"--secondary-color-50")||s.getCssPropertyValue(r,"color"),colorBackground:s.getCssPropertyValue(r,"--background-color")||s.getCssPropertyValue(r,"background-color"),fontFamily:s.getCssPropertyValue(r,"font-family"),focusColor:s.getCssPropertyValue(r,"--accent-color")||s.getCssPropertyValue(r,"color")},i.WPForms&&WPForms.FrontendModern&&(r.colorPrimary=WPForms.FrontendModern.getSolidColor(r.colorPrimary)),{theme:"none",labels:e.data("sublabel-position"),sublabelHide:o,variables:{colorPrimary:r.colorPrimary,colorBackground:r.colorBackground,colorText:r.colorText,colorDanger:"#990000",fontFamily:r.fontFamily,spacingUnit:"4px",spacingGridRow:"8px",fontSizeSm:"13px",fontWeightNormal:"400",borderRadius:r.borderRadius,colorTextPlaceholder:r.colorTextPlaceholder,colorIcon:r.colorText},rules:{".Input--invalid":{color:r.colorText,borderColor:"#cc0000"},".Input":{border:"none",borderRadius:r.borderRadius,boxShadow:"0 0 0 1px "+r.borderColor,fontSize:r.fontSize,padding:"12px 14px",lineHeight:parseInt(r.fontSize,10)+5+"px",transition:"none",color:r.colorText,backgroundColor:r.colorBackground},".Input:focus, .Input:hover":{border:"none",boxShadow:"0 0 0 2px "+r.focusColor,outline:"none"},".Label":{fontFamily:r.fontFamily,lineHeight:o?"1.3":"0",opacity:Number(o),color:r.colorPrimary},".CheckboxInput, .CodeInput, .PickerItem":{border:"1px solid "+r.borderColor},".Tab, .Block":{border:"1px solid "+r.borderColor,borderRadius:r.borderRadius,color:r.colorText},".TabLabel, .TabIcon":{color:r.colorText},".Tab--selected":{borderColor:"#999999",color:r.colorText},".Action":{marginLeft:"6px"},".Action, .MenuAction":{border:"none",backgroundColor:"transparent"},".Action:hover, .MenuAction:hover":{border:"none",backgroundColor:"transparent"},".Error, .RedirectText":{color:r.colorText},".TabIcon--selected":{fill:r.colorText}}}):t},getCustomAppearanceOptions(){return"object"==typeof i.wpformsStripePaymentElementAppearance?i.wpformsStripePaymentElementAppearance:l.isEmptyObject(wpforms_stripe.data.element_appearance)?{}:wpforms_stripe.data.element_appearance},getCssPropertyValue(e,o){try{return e.css(o)}catch(e){return""}},initializePaymentElement(o,e=""){const r=o.find(".wpforms-field-stripe-credit-card .wpforms-field-row"),t=o.data("formid");s.forms[t].paymentElement&&s.forms[t].paymentElement.destroy(),s.forms[t].paymentElement=s.forms[t].elements.create("payment",{defaultValues:{billingDetails:{email:e}}}),s.mountPaymentElement(o),s.forms[t].paymentElement.on("change",function(e){s.forms[t].paymentType=e.value.type,r.data("link-email")||("google_pay"===e.value.type||"apple_pay"===e.value.type?(s.forms[t].linkElement.destroy(),s.forms[t].linkDestroyed=!0):s.forms[t].linkDestroyed&&(s.initializeLinkAuthenticationElement(o),s.forms[t].linkDestroyed=!1)),r.data("type",e.value.type),e.empty?(r.data("completed",!1),r.find("label.wpforms-error").toggle("card"===e.value.type)):(s.forms[t].elementsModified=!0,e.complete?(r.data("completed",!0),s.hideStripeFieldError(o)):r.data("completed",!1))}),s.forms[t].paymentElement.on("loaderror",function(e){s.displayStripeLoadError(o,e.error.message)})},mountPaymentElement(e){var e=e.data("formid"),o="#wpforms-field-stripe-payment-element-"+e;s.forms[e].paymentElement.mount(o)},linkEmailMappedFieldTriggers(e){const o=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row");var r=s.getMappedLinkEmailField(e);if(r){const t=e.data("formid");r.on("change",function(){s.forms[t].linkEmail=l(this).val(),o.data("completed")||s.initializePaymentElement(e,l(this).val())})}else o.data("linkCompleted",!1),s.initializeLinkAuthenticationElement(e)},getMappedLinkEmailField(e){var o=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row").data("link-email");return o?(e=e.data("formid"),l(`#wpforms-${e}-field_`+o)):null},initializeLinkAuthenticationElement(o){const r=o.find(".wpforms-field-stripe-credit-card .wpforms-field-row"),t=o.data("formid");s.forms[t].linkElement=s.forms[t].elements.create("linkAuthentication"),s.mountLinkElement(o),s.forms[t].linkElement.on("change",function(e){e.empty||(s.forms[t].elementsModified=!0,e.complete?(void 0!==e.value.email&&(s.forms[t].linkEmail=e.value.email),r.data("linkCompleted",!0),s.hideStripeFieldError(o)):r.data("linkCompleted",!1))}),s.forms[t].linkElement.on("loaderror",function(e){s.displayStripeLoadError(o,e.error.message)})},mountLinkElement(e){var e=e.data("formid"),o="#wpforms-field-stripe-link-element-"+e;s.forms[e].linkElement.mount(o)},submitHandler(e){var e=l(e),o=e.find(".wpforms-field-stripe-credit-card"),r=o.find(".wpforms-field-row"),t=e.validate().form(),n=e.data("formid"),i=r.data("required"),n=!r.data("link-email")&&s.forms[n].elementsModified||r.data("completed");let a=!1;o.hasClass("wpforms-conditional-hide")||(a=i||n&&!i),t&&a?(e.find(".wpforms-submit").prop("disabled",!0),e.find(".wpforms-submit-spinner").show(),s.createPaymentMethod(e)):t?d(e):(e.find(".wpforms-submit").prop("disabled",!1),e.validate().cancelSubmit=!0)},updateElementsTotalAmount(e,o,r){var t;r&&(o=o.data("formid"),s.forms[o])&&s.forms[o].elements&&(t=wpforms.getCurrency(),s.forms[o].total=r,s.forms[o].elements.update({amount:parseInt(wpforms.numberFormat(r,t.decimals,"",""),10)}))},async createPaymentMethod(r){const t=r.data("formid");s.forms[t].total?await s.stripe.createPaymentMethod({elements:s.forms[t].elements}).then(function(e){var o;e.error?(o=["incomplete_email","email_invalid","incomplete_number","invalid_number","incomplete_expiry","invalid_expiry_year_past","invalid_expiry_year","incomplete_cvc","incomplete_name","incomplete_phone_number","empty_phone_number"].includes(e.error.code)?"":e.error.message,s.displayStripeFieldError(r,o)):(s.forms[t].paymentMethodId=e.paymentMethod.id,r.append('<input type="hidden" class="wpforms-stripe-payment-method-id" name="wpforms[payment_method_id]" value="'+s.forms[t].paymentMethodId+'">'),d(r))}):d(r)},formAjaxUnblock(e){var o=e.find(".wpforms-submit"),r=o.data("submit-text");r&&o.text(r),o.prop("disabled",!1),o.removeClass("wpforms-disabled"),e.closest(".wpforms-container").css("opacity",""),e.find(".wpforms-submit-spinner").hide()},displayStripeError(e,o){wpforms.clearFormAjaxGeneralErrors(e),wpforms.displayFormAjaxErrors(e,o),s.formAjaxUnblock(e)},displayStripeFieldError(e,o){var r=e.find(".wpforms-stripe-credit-card-hidden-input").attr("name"),t=e.find(".wpforms-field-stripe-credit-card"),n={};o&&(n[r]=o),wpforms.displayFormAjaxFieldErrors(e,n),!t.is(":visible")&&0<e.find(".wpforms-page-indicator-steps").length&&wpforms.setCurrentPage(e,{}),wpforms.scrollToError(t),s.formAjaxUnblock(e)},hideStripeFieldError(e){e.find(".wpforms-field-stripe-credit-card .wpforms-error").hide()},displayStripeLoadError(e,o){o=wpforms_stripe.i18n.element_load_error+"<br /> "+o,s.displayStripeError(e,o)},pageChange(e,o,r,t){var n=r.find(".wpforms-field-stripe-credit-card .wpforms-field-row"),i=r.data("formid");n.length&&-1!==["card","link"].indexOf(s.forms[i].paymentType)&&(s.forms[i].elementsModified||"card"!==s.forms[i].paymentType||(s.forms[i].paymentElement.unmount(),s.mountPaymentElement(r),n.data("link-email"))||(s.forms[i].linkElement.unmount(),s.mountLinkElement(r)),!n.is(":visible")||!n.data("required")&&!s.forms[i].elementsModified||s.forms[i].lockedPageToSwitch&&s.forms[i].lockedPageToSwitch!==o||"prev"===t||(t=void 0===n.data("linkCompleted")||n.data("linkCompleted"),n.data("completed")&&t?s.hideStripeFieldError(r):(s.forms[i].lockedPageToSwitch=o,s.displayStripeFieldError(r,wpforms_stripe.i18n.empty_details),e.preventDefault())))},convFormsFieldActivationAfter(e,o){s.setupPaymentElement(o.$el.closest("form"))},getCssVar(e,o){return console.warn('WARNING! Function "WPFormsStripePaymentElement.getCssVar()" has been deprecated, please use the "WPForms.FrontendModern.getCssVar()" function instead!'),WPForms?.FrontendModern?.getCssVar()},updatePaymentElementStylesModern(e){var o;l.isEmptyObject(s.getCustomAppearanceOptions())&&i.WPForms&&WPForms.FrontendModern&&e&&0!==e.length&&!e.closest(".wpforms-container").hasClass("wpforms-lead-forms-container")&&(o=e.data("formid"),s.forms[o])&&(o=s.forms[o].elements,e=WPForms.FrontendModern.getCssVars(e),s.updateFormElementsAppearance(o,e))},updateFormElementsAppearance(e,o){var r,t;e&&e._commonOptions&&(r=e._commonOptions.appearance,o["field-size-padding-v"]=(parseInt(o["field-size-input-height"],10)-parseInt(o["field-size-font-size"],10)-6)/2+"px",r.variables.spacingGridRow=o["field-size-input-spacing"],r.variables.spacingGridColumn="20px",r.variables.spacingTab="10px",r.variables.colorText=WPForms.FrontendModern.getSolidColor(o["field-text-color"]),t=WPFormsUtils.cssColorsUtils.isTransparentColor(o["field-background-color"])?o["field-menu-color"]:o["field-background-color"],t=WPForms.FrontendModern.getSolidColor(t),r.rules={".Input":{border:o["field-border-size"]+" "+o["field-border-style"]+" "+o["field-border-color"],borderRadius:o["field-border-radius"],padding:o["field-size-padding-v"]+" "+o["field-size-padding-h"],fontSize:o["field-size-font-size"],lineHeight:o["field-size-font-size"],backgroundColor:o["field-background-color"],boxShadow:"none",outline:"none"},".Input:focus":{backgroundColor:t,borderColor:o["button-background-color"],borderStyle:"solid",boxShadow:"0 0 0 1px "+o["button-background-color"],outline:"none"},".Input--invalid":{borderColor:o["label-error-color"],boxShadow:"none",color:r.variables.colorText,outline:"none"},".Input--invalid:focus":{borderColor:o["label-error-color"],boxShadow:"0 0 0 1px "+o["label-error-color"],outline:"none"},".Input::placeholder":{color:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.5"),fontSize:o["field-size-font-size"]},".CheckboxInput":{border:"1px solid "+o["field-border-color"],backgroundColor:o["field-background-color"]},".CheckboxInput--checked":{borderColor:o["button-background-color"],backgroundColor:o["button-background-color"]},".CodeInput":{border:"1px solid "+o["field-text-color"],backgroundColor:t},".CodeInput:focus":{borderWidth:"2px",boxShadow:"0 0 0 1px "+o["button-background-color"],outline:"none"},".CodeInput:disabled":{borderColor:WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),color:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.5")},".Label":{fontSize:o["label-size-sublabel-font-size"],margin:`0 0 ${o["field-size-sublabel-spacing"]} 0`,color:o["label-sublabel-color"],opacity:Number(Boolean(r?.sublabelHide)),lineHeight:r?.sublabelHide?"inherit":"0"},".Error":{fontSize:o["label-size-sublabel-font-size"],margin:o["field-size-sublabel-spacing"]+" 0 0 0",color:o["label-error-color"]},".Tab":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),borderRadius:o["field-border-radius"],backgroundColor:"transparent",boxShadow:"none",marginTop:"0"},".Tab:focus":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["button-background-color"],"0.5"),boxShadow:"0 0 0 3px "+WPForms.FrontendModern.getColorWithOpacity(o["button-background-color"],"0.25"),outline:"none"},".Tab:hover":{border:"1px solid "+o["field-border-color"]},".Tab--selected":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"],backgroundColor:o["field-background-color"]},".Tab--selected:hover":{borderColor:o["button-background-color"]},".Tab--selected:focus":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"]},".TabLabel":{color:o["field-text-color"]},".TabIcon":{fill:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.75")},".TabIcon--selected":{fill:o["field-text-color"]},".TabIcon:hover":{color:o["field-text-color"],fill:o["field-text-color"]},".TabLabel--selected":{color:o["button-background-color"]},".Block":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),backgroundColor:t,borderRadius:o["field-border-radius"],boxShadow:"none"},".AccordionItem":{backgroundColor:t,paddingLeft:0,paddingRight:0,color:o["field-text-color"]},".PickerItem,":{backgroundColor:t}},e.update({appearance:r}))}};return s}(document,window,jQuery);WPFormsStripePaymentElement.init();